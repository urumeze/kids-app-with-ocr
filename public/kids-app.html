<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoQuiz</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

    


    <style>
         :root{
      --bg:#f6fbff;
      --primary:#5c7cfa; /* friendly blue */
      --accent:#ff66b3; /* pink */
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.7);
    }

    *{box-sizing:border-box}
    body,html{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial}

    /* app shell */
    .app{
      min-height:100vh;
      background: linear-gradient(180deg,#f8feff 0%, #eef6ff 100%);
      display:flex;align-items:center;justify-content:center;flex-direction:column;padding:32px;
    }
    .app h1{color:#0f172a;margin:0 0 8px;font-size:clamp(20px,4vw,32px)}
    .app p{color:var(--muted);margin:0 0 24px}
    .card{width:100%;max-width:980px;background:var(--glass);backdrop-filter: blur(6px);border-radius:14px;padding:28px;box-shadow:0 8px 30px rgba(16,24,40,0.08);text-align:center}

   
   
    .subtitle{color:var(--muted);font-size:13px;margin-bottom:18px}

    .actions{display:flex;gap:12px;flex-direction:column}
    .btn{
      appearance:none;border:0;padding:12px 14px;border-radius:10px;font-weight:600;cursor:pointer;font-size:14px;transition:transform .15s ease,box-shadow .15s ease;display:flex;align-items:center;justify-content:center;gap:10px
    }
   

    .small{font-size:12px;color:var(--muted);margin-top:12px}

    /* animated circle */
    .pulse-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .big-circle{
      width:80px;height:80px;border-radius:50%;transform:scale(0);opacity:0;filter:blur(.4px);
      background:conic-gradient(from 0deg, #5c7cfa, #ff66b3, #34d399, #ff9f43, #5c7cfa);
      transition:opacity .15s linear;z-index:10
    }

    /* keyframes for colorful expand lasting 2s */
    @keyframes circleBurst{
      0%{transform:scale(0);opacity:1;filter:blur(0px)}
      40%{transform:scale(1.05);opacity:1}
      100%{transform:scale(40);opacity:1;filter:blur(6px)}
    }

   
    /* final page easing */
    .app.revealed{opacity:1;transform:none}

    /* small helpful footer */
    .credit{font-size:12px;color:var(--muted);margin-top:14px}

    /* Responsive */
    @media (min-width:720px){.actions{flex-direction:row}}
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        .design {
            body {
  font-family: 'Comic Neue', 'Comic Sans MS', 'Chalkboard SE', 'Comic Sans';
}

            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .shape {
            position: absolute;
            opacity: 0.3;
            z-index: -1;
        }
        
        .circle {
            border-radius: 50%;
            background: #FF9AA2;
        }
        
        .triangle {
            width: 0;
            height: 0;
            border-left: 50px solid transparent;
            border-right: 50px solid transparent;
            border-bottom: 100px solid #FFB7B2;
        }
        
        .square {
            background: #B5EAD7;
        }
        
        .pentagon {
            width: 54px;
            height: 50px;
            background: #C7CEEA;
            position: relative;
        }
        
        .pentagon:before {
            content: "";
            position: absolute;
            top: -25px;
            left: 0;
            width: 0;
            height: 0;
            border-left: 27px solid transparent;
            border-right: 27px solid transparent;
            border-bottom: 25px solid #C7CEEA;
        }
        
        .pentagon:after {
            content: "";
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 0;
            height: 0;
            border-left: 27px solid transparent;
            border-right: 27px solid transparent;
            border-top: 25px solid #C7CEEA;
        }
        
        .upload-container {
            border: 3px dashed #94a3b8;
            transition: all 0.3s;
        }
        
        .upload-container:hover {
            border-color: #6366f1;
            background-color: rgba(99, 102, 241, 0.05);
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #6366f1;
            transition: width 0.3s;
        }
        
        .bounce {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .rotate {
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .summary-box {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-option {
            transition: all 0.3s;
        }
        
        .quiz-option:hover {
            transform: scale(1.05);
        }
        
        .correct {
            background-color: #4ade80 !important;
        }
        
        .incorrect {
            background-color: #f87171 !important;
        }

        
#google-sign-in-container {
  position: fixed; /* or absolute */
  bottom: 20px; /* Adjust as needed for desired position */
  right: 20px;  /* Adjust as needed for desired position */
  z-index: 1000; /* Ensures it stays on top of other content */
  /* Optional: Add styling for a subtle background or shadow */
  background-color: white;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

/* Fixed header */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #1e1e1e;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
  }

  .header .title {
    font-size: 1.5rem;
    font-weight: bold;
  }

  /* Coin container */
  .coin-container {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.2rem;
    cursor: default;
  }
  /* default styles for inline SVG - you can move to your CSS file too */
    .coin-svg { display:inline-block; vertical-align:middle; }
    .coin-svg .shimmerRect { transition: opacity 150ms linear; }

    /* .flash class triggers shimmer and a quick pop */
    .coin-svg.flash { transform-origin: center; animation: coinPop 300ms ease; }
    .coin-svg.flash .shimmerRect {
      opacity: 1;
      /* animate the rect sliding across the coin */
      animation: shimmerMove 700ms linear;
    }

    @keyframes shimmerMove {
      0%   { transform: translateX(-120px); }
      100% { transform: translateX(120px); }
    }

    @keyframes coinPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.18); }
      100% { transform: scale(1); }
    }


  .coin:hover {
    transform: scale(1.1);
  }

  /* Number next to coin */
  .coin-number {
    font-weight: bold;
    color: purple;
  }
  .coin-caller {
    font-weight: bold;
    color: greenyellow;
  }


#splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #800080;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      animation: fadeOut 3.5s forwards; /* fade out after loader fills */
    }

    #splash h1 {
      color: white;
      font-size: 3rem;
      margin-bottom: 30px;
      font-family: sans-serif;
    }

    /* Loader bar container */
    .loader-bar {
      width: 300px;
      height: 8px;
      background-color: #a64ca6;
      border-radius: 4px;
      overflow: hidden;
    }

    /* Loader bar fill animation */
    .loader-fill {
      height: 100%;
      width: 0%;
      background-color: #1e90ff;
      border-radius: 4px;
      animation: fillBar 3s forwards; /* 3s fill */
    }

    @keyframes fillBar {
      from { width: 0%; }
      to { width: 100%; }
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      85% { opacity: 1; } /* keep visible until almost done */
      100% { opacity: 0; display: none; }
    }

    /* Hide main content initially */
    #main-content {
      display: none;
    }

    /* Show main content after splash */
    #splash.fade-complete + #main-content {
      display: block;
    }

    
    .music-menu-container {
  position: fixed;
  bottom: 1.5rem; /* bottom-6 */
  right: 1.5rem;  /* right-6 */
  width: 60px;
  height: 60px;
  z-index: 50;
}

.menu-toggle-button {
  background-color: #7e22ce; /* purple-700 */
  color: white;
  border: none;
  border-radius: 50%;
  width: 100%;
  height: 100%;
  font-size: 26px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(126, 34, 206, 0.4);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.menu-toggle-button:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 14px rgba(126, 34, 206, 0.6);
}

/* Circular menu background */
.circular-menu {
  position: absolute;
  bottom: 100px; /* opens upward */
  right: 1px;  /* opens leftward */
  transform: scale(0);
  
  border-radius:10px;
  width: 30px;
  height: 220px;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: all 0.35s ease-in-out;
  flex-wrap: wrap;
  gap: 12px;
  box-shadow: 0 8px 16px rgba(126, 34, 206, 0.3);
}

.circular-menu.open {
  transform: scale(1);
  opacity: 1;
}

/* Buttons inside the circle */
.menu-button {
  background-color: #a855f7; /* purple-500 */
  color: white;
  border: none;
  border-radius: 50%;
  width: 55px;
  height: 55px;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background-color 0.2s, transform 0.2s;
}

.menu-button:hover {
  background-color: #9333ea; /* darker purple on hover */
  transform: scale(1.1);
}

  .hidden { display: none; }
  .question { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius:5px; }
  input { width: 100%; padding: 5px; margin-top: 5px; }
  button { cursor: pointer; }



.post-card {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    width: 100%;
    max-width: 500px;
    padding: 20px;
    box-sizing: border-box;
}

.card-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #f0f2f5;
}

#postText {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
    resize: none; /* Prevents vertical resizing */
    font-size: 15px;
    margin-bottom: 15px;
    transition: border-color 0.2s;
}

#postText:focus {
    outline: none;
    border-color: #007bff;
}

.card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.file-input {
    font-size: 14px;
    color: #555;
    /* Hide the default input style for better control, often managed by a custom button/icon in real apps */
    /* display: none; */ 
}

.submit-btn {
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    transition: background-color 0.2s;
}

.submit-btn:hover {
    background-color: #0056b3;
}

.status-message {
    font-size: 13px;
    color: #606770;
    margin: 0 10px 0 0; /* Space between message and button */
    flex-grow: 1; /* Allows status message to fill available space */
    text-align: right;
}

/* Add CSS classes for dynamic status updates via JS if needed */
/*
.status-message.error { color: #dc3545; }
.status-message.success { color: #28a745; }
*/




    </style>
</head>
<body class="design">
  
<!-- Splash Screen -->
<div id="splash">
    <h1>GoQuiz.app</h1>
    <div class="loader-bar">
      <div class="loader-fill" id="loader"></div>
    </div>
</div>
<div class="container mx-auto px-4 py-8">

  <!-- Header -->
  <!-- Removed 'relative w-full flex items-center justify-center' from the header itself -->
  <header class="flex justify-between items-center py-3">

    <!-- Title (Left Aligned by default) -->
    <h1 id="goquizTitle"
        class="text-xl font-bold text-white bg-indigo-600 px-4 py-1 rounded-lg">
      GoQuiz
    </h1>

    <!-- Floating Coin Widget (Pushed to the Extreme Right via justify-between on header) -->
    <!-- Changed from flex-col (vertical stack) to flex (horizontal row) -->
    <!-- Removed 'absolute top-1 right-2 z-50' positioning -->
    <div id="floatingCoin" 
         class="flex items-center gap-3">

      <!-- Points (Combined into the main flex flow) -->
      <!-- Adjusted sizing for mobile screen real estate -->
      <div class="flex items-center gap-1">
        <div class="bg-white coin-number text-base font-bold px-2 py-0.5 rounded" id="coinNumber">0</div>
        <div id="pointsLabel" class="font-semibold text-sm text-gray-700">pts</div>
      </div>

      <!-- Convert button -->
      <!-- Adjusted sizing for mobile screen real estate -->
      <button 
        class="flex items-center px-2 py-1 bg-green-500 text-white rounded-md 
               hover:bg-green-600 transition duration-300 ease-in-out group text-sm shadow">
          <span class="mr-1">Convert</span>
          <span class="text-xl transition-transform duration-500 ease-in-out 
                       group-hover:[transform:rotate(180deg)]">
            ‚Üí
          </span>
      </button>

      <!-- GQ Counter + Coin (Combined into the main flex flow) -->
      <!-- Adjusted sizing for mobile screen real estate -->
      <div class="flex items-center gap-1">

        <div 
          id="GqCount" 
          class="text-2xl font-black px-1 py-0.5 bg-white rounded-lg shadow text-center 
                 min-w-[40px] bg-clip-text text-transparent 
                 bg-gradient-to-r from-yellow-400 to-amber-600
                 transition-transform duration-200 ease-out">
          0
        </div>

        <!-- Your full SVG preserved -->
        <svg class="coin-svg" id="gqCoin" xmlns="http://www.w3.org/2000/svg" 
             viewBox="0 0 120 120" width="32" height="32" role="img" aria-label="GQ coin">
          <defs>
            <radialGradient id="gq_g" cx="40%" cy="35%" r="70%">
              <stop offset="0%" stop-color="#fff9c4"/>
              <stop offset="40%" stop-color="#fbc02d"/>
              <stop offset="80%" stop-color="#f57f17"/>
              <stop offset="100%" stop-color="#bf360c"/>
            </radialGradient>

            <linearGradient id="gq_shine" x1="0" y1="0" x2="1" y2="0">
              <stop offset="0%" stop-color="rgba(255,255,255,0)" />
              <stop offset="45%" stop-color="rgba(255,255,255,0.9)" />
              <stop offset="55%" stop-color="rgba(255,255,255,0.9)" />
              <stop offset="100%" stop-color="rgba(255,255,255,0)" />
            </linearGradient>
          </defs>

          <circle cx="60" cy="60" r="55" fill="url(#gq_g)" stroke="#b8860b" stroke-width="4"/>
          <circle cx="60" cy="60" r="44" fill="none" stroke="#ffecb3" stroke-width="3"/>
          <circle cx="60" cy="60" r="36" fill="url(#gq_g)" opacity="0.98"/>

          <g class="shimmerGroup">
            <rect x="-120" y="0" width="240" height="120" fill="url(#gq_shine)" 
                  opacity="0" class="shimmerRect"/>
          </g>

          <text x="60" y="74" text-anchor="middle"
                font-family="Inter, Arial, Helvetica, sans-serif"
                font-weight="800" font-size="36" fill="#3b2a0c" 
                stroke="#fff6d8" stroke-width="0.6" paint-order="stroke">
            GQ
          </text>
          <ellipse cx="44" cy="42" rx="28" ry="10" transform="rotate(-20 44 42)"
                   fill="rgba(255,255,255,0.18)" opacity="0.85"/>
        </svg>

      </div>

    </div>
  </header>

</div>



<!-- Teacher Button -->
<button id="openTeacherPost"
    class="fixed bottom-20 right-4 bg-purple-600 text-white px-4 py-2 rounded-full shadow-lg">
  Are you a teacher? Post ad
</button>

<!-- Teacher Form Overlay -->
<div id="teacherFormOverlay"
     class="fixed inset-0 bg-black bg-opacity-60 hidden flex justify-center items-center p-4 z-50">

  <div class="bg-white rounded-2xl p-6 w-full max-w-sm space-y-3">

      <h2 class="text-xl font-semibold text-center mb-2">Teacher Profile</h2>

      <input type="text" id="teacherName" placeholder="Name"
        class="w-full border p-2 rounded-xl"/>

      <select id="teacherGender" class="w-full border p-2 rounded-xl">
          <option value="">Select gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
      </select>

      <input type="text" id="teacherSubject" placeholder="Subject"
        class="w-full border p-2 rounded-xl"/>

      <input type="file" id="teacherImage" accept="image/*"
        class="w-full"/>

      <button id="submitTeacherPost"
        class="bg-green-600 text-white w-full py-2 rounded-xl shadow">
        Submit
      </button>

      <button id="closeTeacherPost"
        class="text-gray-600 w-full py-2 underline">
        Cancel
      </button>
  </div>
</div>

 
<div class="music-menu-container fixed bottom-6 right-6 z-50">
  <button id="menu-toggle" class="menu-toggle-button">üéµ</button>
  <div id="circular-menu" class="circular-menu">
    <button id="next-button" class="menu-button">‚è≠</button>
    <button id="pause-button" class="menu-button">‚è∏</button>
    <button id="prev-button" class="menu-button">‚èÆ</button>
    <button id="play-button" class="menu-button">‚ñ∂</button>
    
  </div>
</div>

<audio id="audio-player"></audio>










<!-- Conversion Modal -->
<div id="convertModal" 
     style="display:none; position: fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.6); backdrop-filter:blur(2px); 
            z-index:2000; justify-content:center; align-items:center;">
    
  <div style="background:white; padding:20px; border-radius:12px; width:320px; box-shadow:0 4px 20px rgba(0,0,0,0.3);">
    
    <h2 style="font-size:20px; font-weight:700; margin-bottom:15px;">Convert</h2>

    <!-- FROM dropdown -->
    <label>From:</label>
    <select id="convertFrom" class="w-full p-2 border rounded mb-3">
      <option value="points">Points</option>
      <option value="gq">GQ</option>
    </select>

    <!-- TO dropdown -->
    <label>To:</label>
    <select id="convertTo" class="w-full p-2 border rounded mb-3">
      <option value="gq">GQ</option>
      <option value="points">Points</option>
    </select>

    <!-- Amount -->
    <label>Amount to Convert:</label>
    <input id="convertAmount" 
           type="number" 
           class="w-full p-2 border rounded mb-4" 
           placeholder="Enter amount">

    <!-- Action buttons -->
    <div style="display:flex; justify-content:space-between; margin-top:10px;">
      <button id="closeConvertModal" 
              style="padding:8px 14px; background:#aaa; color:white; border-radius:8px;">Cancel</button>

      <button id="confirmConvert" 
              style="padding:8px 14px; background:#22c55e; color:white; border-radius:8px;">Convert</button>
    </div>

  </div>

</div>







<!-- Load Google Identity Services -->


<div id="g_id_onload"
         data-client_id="845525258490-kr08g5n00eevukimo32mdaf65pjc25md.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-nonce=""
         data-auto_select="true"
         data-itp_support="true">
</div>



<div id="teacherAdOverlay" class="flex space-x-4 overflow-x-auto p-2 snap-x snap-mandatory">

</div>




<!-- üìö MENU PANEL -->
<div id="menuPanel"
     class="fixed left-0 top-0 h-full w-40 bg-white shadow-xl transform -translate-x-full transition-transform duration-300 z-40 overflow-y-auto">
  <div class="flex justify-end">
  <button id="closeMenuBtn" class="text-gray-600 hover:text-black">
    close
  </button>
</div>


  <!-- Menu Content -->
<div class="p-4">

  <!-- MAIN MENU BUTTON -->
  <button class="year-btn font-semibold text-gray-700 w-full text-left bg-green-100 rounded-lg">
  COMMON ENTRANCE ‚ñº
</button>


  <!-- MUST be a subject-list so the JS can toggle it -->
  <ul class="subject-list hidden space-y-3">

    <!-- 2020 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left ">2020 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2020,'maths','common_entrance')" class="subject-btn">*Mathematics</button></li>
        <li><button onclick="loadPastQuestions(2020,'verbal_and_vocational_aptitude','common_entrance')" class="subject-btn">Verbal & Vocational Aptitude</button></li>
        <li><button onclick="loadPastQuestions(2020,'basic_science','common_entrance')" class="subject-btn">*Basic science</button></li>
      </ul>
    </li>

    <!-- 2021 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2021 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2021,'english','common_entrance')" class="subject-btn">*English</button></li>
        <li><button onclick="loadPastQuestions(2021,'maths','common_entrance')" class="subject-btn">*Mathematics</button></li>
        <li><button onclick="loadPastQuestions(2021,'basic_science','common_entrance')" class="subject-btn">*Basic science</button></li>
        <li><button onclick="loadPastQuestions(2021,'verbal_and_vocational_aptitude','common_entrance')" class="subject-btn">Verbal & Vocational Aptitude</button></li>
      </ul>
    </li>

    <!-- 2022 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2022 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2022,'english','common_entrance')" class="subject-btn">*English</button></li>
        <li><button onclick="loadPastQuestions(2022,'maths','common_entrance')" class="subject-btn">*Mathematics</button></li>
        <li><button onclick="loadPastQuestions(2022,'basic_science','common_entrance')" class="subject-btn">*Basic science</button></li>
        <li><button onclick="loadPastQuestions(2022,'basic_studies','common_entrance')" class="subject-btn">*Basic studies</button></li>
      </ul>
    </li>

    <!-- 2023 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2023 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2023,'english','common_entrance')" class="subject-btn">*English</button></li>
        <li><button onclick="loadPastQuestions(2023,'maths','common_entrance')" class="subject-btn">*Mathematics</button></li>
        <li><button onclick="loadPastQuestions(2023,'Quantitative_aptitude','common_entrance')" class="subject-btn">Quantitative aptitude</button></li>
        <li><button onclick="loadPastQuestions(2023,'verbal_aptitude','common_entrance')" class="subject-btn">Verbal aptitude</button></li>
      </ul>
    </li>

    <!-- 2024 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2024 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2024,'english','common_entrance')" class="subject-btn">*English</button></li>
        <li><button onclick="loadPastQuestions(2024,'maths','common_entrance')" class="subject-btn">*Mathematics</button></li>
        <li><button onclick="loadPastQuestions(2024,'basic_technology','common_entrance')" class="subject-btn">*Basic technology</button></li>
        <li><button onclick="loadPastQuestions(2024,'social_studies','common_entrance')" class="subject-btn">*Social studies</button></li>
        <li><button onclick="loadPastQuestions(2024,'basic_science','common_entrance')" class="subject-btn">*Basic science</button></li>
        <li><button onclick="loadPastQuestions(2024,'civic_education','common_entrance')" class="subject-btn">*Civic education</button></li>
        <li><button onclick="loadPastQuestions(2024,'computer_studies','common_entrance')" class="subject-btn">*Computer St.</button></li>
        <li><button onclick="loadPastQuestions(2024,'physical_and_health_education','common_entrance')" class="subject-btn">*PHE</button></li>
      </ul>
    </li>

  </ul>
</div>




<div class="p-4">

  <!-- MAIN JAMB BUTTON -->
  <button class="year-btn font-semibold text-gray-700 w-full text-left bg-blue-100 rounded-lg">JAMB ‚ñº</button>

  <!-- MUST be subject-list so JS can toggle it -->
  <ul class="subject-list hidden space-y-3">

    <!-- 2020 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left ">2020 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2020,'english','jamb')" class="subject-btn">English</button></li>
        <li><button onclick="loadPastQuestions(2020,'maths','jamb')" class="subject-btn">Maths</button></li>
        <li><button onclick="loadPastQuestions(2020,'physics','jamb')" class="subject-btn">Physics</button></li>
        <li><button onclick="loadPastQuestions(2020,'chemistry','jamb')" class="subject-btn">Chemistry</button></li>
        <li><button onclick="loadPastQuestions(2020,'biology','jamb')" class="subject-btn">Biology</button></li>
        <li><button onclick="loadPastQuestions(2020,'economics','jamb')" class="subject-btn">Economics</button></li>
        <li><button onclick="loadPastQuestions(2020,'literature','jamb')" class="subject-btn">English Literature</button></li>
      </ul>
    </li>

    <!-- 2021 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2021 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2021,'english','jamb')" class="subject-btn">English</button></li>
        <li><button onclick="loadPastQuestions(2021,'maths','jamb')" class="subject-btn">Maths</button></li>
        <li><button onclick="loadPastQuestions(2021,'physics','jamb')" class="subject-btn">Physics</button></li>
        <li><button onclick="loadPastQuestions(2021,'chemistry','jamb')" class="subject-btn">Chemistry</button></li>
        <li><button onclick="loadPastQuestions(2021,'biology','jamb')" class="subject-btn">Biology</button></li>
        <li><button onclick="loadPastQuestions(2021,'economics','jamb')" class="subject-btn">Economics</button></li>
        <li><button onclick="loadPastQuestions(2021,'literature','jamb')" class="subject-btn">English Literature</button></li>
      </ul>
    </li>

    <!-- 2022 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2022 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2022,'english','jamb')" class="subject-btn">English</button></li>
        <li><button onclick="loadPastQuestions(2022,'maths','jamb')" class="subject-btn">Maths</button></li>
        <li><button onclick="loadPastQuestions(2022,'physics','jamb')" class="subject-btn">Physics</button></li>
        <li><button onclick="loadPastQuestions(2022,'chemistry','jamb')" class="subject-btn">Chemistry</button></li>
        <li><button onclick="loadPastQuestions(2022,'biology','jamb')" class="subject-btn">Biology</button></li>
        <li><button onclick="loadPastQuestions(2022,'economics','jamb')" class="subject-btn">Economics</button></li>
        <li><button onclick="loadPastQuestions(2022,'literature','jamb')" class="subject-btn">English Literature</button></li>
      </ul>
    </li>

    <!-- 2023 -->
    <li>
      <button class="year-btn font-semibold text-gray-700 w-full text-left">2023 ‚ñº</button>
      <ul class="subject-list hidden ml-4 mt-1 space-y-1">
        <li><button onclick="loadPastQuestions(2023,'english','jamb')" class="subject-btn">English</button></li>
        <li><button onclick="loadPastQuestions(2023,'maths','jamb')" class="subject-btn">Maths</button></li>
        <li><button onclick="loadPastQuestions(2023,'physics','jamb')" class="subject-btn">Physics</button></li>
        <li><button onclick="loadPastQuestions(2023,'chemistry','jamb')" class="subject-btn">Chemistry</button></li>
        <li><button onclick="loadPastQuestions(2023,'biology','jamb')" class="subject-btn">Biology</button></li>
        <li><button onclick="loadPastQuestions(2023,'economics','jamb')" class="subject-btn">Economics</button></li>
        <li><button onclick="loadPastQuestions(2023,'literature','jamb')" class="subject-btn">English Literature</button></li>
      </ul>
    </li>

  </ul>

</div>


    <div class="p-4">
    
<button class="year-btn font-semibold text-gray-700 w-full text-left bg-red-100 rounded-lg" data-year="2020">ACCA‚ñº</button>
   
      <!-- 2022 -->
     
        <button class="year-btn font-semibold text-gray-700 w-full text-left hidden" data-year="2020">2023 ‚ñº</button>
        <ul class="subject-list hidden ml-4 mt-1 space-y-1">
          <li><button onclick="loadPastQuestions(2023, 'F1', 'ACCA')">F1</button></li>
          <li><button onclick="loadPastQuestions(2023, 'F3_A', 'ACCA')" class="subject-btn">F3 Section A</button></li>
          <li><button onclick="loadMTQQuestions(2023, 'F3_B', 'ACCA')" class="subject-btn">F3 Section B</button></li>
          <li><button onclick="loadMTQQuestions(2023, 'F3_C', 'ACCA')" class="subject-btn">F3 Section C</button></li>
          
         
        </ul>  
  </div>

  

  
</div>

<!-- Public Feed -->
<div id="feed" class="mt-6 space-y-4"></div> 
</div>




<!-- Floating Open Button -->
<button id="openMenuBtn"
        class="fixed top-4 left-4 bg-blue-600 wd-24 text-white rounded-full p-3 shadow-md hover:bg-blue-700 z-50">
  Menu
</button>





    <!-- Background shapes -->
    <div class="shape circle w-32 h-32 top-20 left-10 rotate"></div>
    <div class="shape triangle top-1/4 right-20 bounce"></div>
    <div class="shape square w-24 h-24 bottom-1/3 left-1/4 rotate"></div>
    <div class="shape pentagon bottom-20 right-1/4 pulse"></div>
    <div class="shape circle w-40 h-40 bottom-10 right-10 rotate"></div>
    <div class="shape triangle top-1/3 left-1/3 bounce"></div>
    
   
        


<!-- === Main App Wrapper === -->
<div id="main-content" class="hidden">
   
<!-- === Public Feed Section === -->
  <main id="publicFeed" class="max-w-3xl mx-auto p-6 space-y-6" >
    
    <!-- Feed will be populated dynamically from past questions -->
  </main>  

  <!-- === Step-Based Quiz Flow === -->
  <main id="app" class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8 hidden">

    <!-- Step 1: Upload -->
    <div id="step1" class="step">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 1: Upload Your School Notes</h2>
      <div id="dropArea" class="upload-container rounded-xl p-8 text-center cursor-pointer mb-6">
        <p class="text-gray-500 mb-4">Drag & drop your file or click to upload</p>
        <input type="file" id="fileInput" class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple>
        <button id="uploadBtn" class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700">Choose File</button>
      </div>
    </div>

    <!-- Step 2: Extracted Text -->
    <div id="step2" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 2: Here's What We Found</h2>
      <div id="extractedText" class="bg-gray-100 p-6 rounded-xl mb-6 text-gray-700 whitespace-pre-line"></div>
      <button id="nextStep2" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Next: Simplify</button>
    </div>

    <!-- Step 3: Simplified Summary -->
    <div id="step3" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 3: Simple Version</h2>
      <div id="simplifiedText" class="summary-box p-6 text-gray-700 mb-6"></div>
      <button id="nextStep3" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Next: Make a Quiz</button>
    </div>

    <!-- Step 4: Quiz Options -->
    <div id="step4" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 4: Quiz Time!</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <button class="quiz-option bg-indigo-100 text-indigo-700 py-4 rounded-xl font-bold text-xl" data-questions="5">5</button>
        <button class="quiz-option bg-indigo-100 text-indigo-700 py-4 rounded-xl font-bold text-xl" data-questions="10">10</button>
        <button class="quiz-option bg-indigo-100 text-indigo-700 py-4 rounded-xl font-bold text-xl" data-questions="15">15</button>
        <button class="quiz-option bg-indigo-100 text-indigo-700 py-4 rounded-xl font-bold text-xl" data-questions="20">20</button>
      </div>
      <button id="nextStep4" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Create My Quiz</button>
    </div>
    <div id="loading" class="hidden">Loading...</div>


    <!-- Step 5: Quiz -->
    <div id="step5" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 5: Let's Test Your Knowledge!</h2>
      <div id="quizContainer" class="mb-8"></div>
      <div id="results" class="mt-6"></div>

      <button id="submitQuiz" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Submit Quiz</button>
      

      <button id="closeQuiz" class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Close</button>

    </div>

    

    <!-- Step 6: Results -->
    <div id="step6" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Step 6: Your Results</h2>
      
      <div class="text-center mb-8  "  >
        <div id="score" class="inline-block bg-indigo-100 text-indigo-800 text-4xl font-bold rounded-full w-32 h-32 flex items-center justify-center ">0%</div>
        <p id="resultMessage" class="text-xl text-gray-700 mt-2 "></p>

      </div>
      
      <div id="wrongAnswers" class="mb-8 " ></div>
      <button id="restartQuiz" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Try Again</button>
      <button id="newDocument" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-full">New Document</button>
    </div>

    <!-- Step 7: Story Feed -->
    <div id="step7" class="step hidden">
      <h2 class="text-2xl font-bold text-indigo-600 mb-6">Story Feed</h2>
      <textarea id="storyInput" rows="3" class="w-full border border-gray-300 rounded-lg p-2 mb-3" placeholder="Share your quiz idea..."></textarea>
      <button id="postStoryBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-full mb-6">Post Story</button>
      <div id="storyFeed" class="space-y-4"></div>

      
</div>

    </div>

    <!-- Step 8: MTQ Results -->
<div id="step8" class="step hidden">
  <h2 class="text-2xl font-bold text-indigo-600 mb-6">MTQ Results</h2>

  <!-- Only MTQ results container is visible -->
  <div id="resultsContainer" class="mt-4 " ></div>

  <!-- Hidden MCQ elements (so Step 8 can reuse Step 6‚Äôs layout style if needed) -->
  <div id="mtqScoreWrapper" class="hidden">
    <div id="mtqScore" class="inline-block bg-indigo-100 text-indigo-800 text-4xl font-bold rounded-full w-32 h-32 flex items-center justify-center"></div>
    <p id="mtqMessage" class="text-xl text-gray-700 mt-2"></p>
  </div>

  <!-- Buttons -->
  <button id="restartMTQ" class="bg-indigo-600 text-white px-6 py-2 rounded-full">Try Again</button>
  <button id="newDocumentMTQ" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-full">New Document</button>
</div>


    

  </main>
</div>



 




<script>

  function handleCredentialResponse(response) {
  const credential = firebase.auth.GoogleAuthProvider.credential(response.credential);
  auth.signInWithCredential(credential)
    .then(result => {
      const user = result.user;
      const firstName = user.displayName?.split(" ")[0] || "User";
      titleElement.textContent = `GoQuiz ${firstName}`;
      localStorage.setItem("firstName", firstName);
    })
    .catch(err => console.error("Firebase sign-in failed:", err));
}



const firebaseConfig = {
    apiKey: "AIzaSyA2WYxbeUFMxy6UF_lP7B0PK01vhrwgSTI",
    authDomain: "kids-note-app.firebaseapp.com",
    projectId: "kids-note-app",
    storageBucket: "kids-note-app.appspot.com",
    messagingSenderId: "845525258490",
    appId: "1:845525258490:web:16ab8dad0a98469456b943",
    measurementId: "G-KHBK5Z52TL"
  };

   firebase.initializeApp(firebaseConfig);

   const auth = firebase.auth();



 
  // ------------------------------
  // App State
  // ------------------------------
  const appState = {
    currentStep: 1,
    extractedText: '',
    simplifiedText: '',
    quizQuestions: 5,
    quizData: [],
    userAnswers: [],
    score: 0
  };

 

// Load user coins from localStorage on page load
let userCoins = parseInt(localStorage.getItem("userCoins")) || 0;

// Update coin display and persist
function updateCoinDisplay(amount = 0) {
  userCoins += amount;
  if (userCoins < 0) userCoins = 0; // don't go negative

  // Save to localStorage
  localStorage.setItem("userCoins", userCoins);

  // Update UI
  const coinNumber = document.getElementById("coinNumber");
  if (coinNumber) coinNumber.textContent = userCoins;

  // Trigger flash animation
  const coinSvg = document.getElementById("gqCoin");
  if (coinSvg) {
    coinSvg.classList.remove("flash"); // reset
    void coinSvg.offsetWidth;          // trigger reflow
    coinSvg.classList.add("flash");    // add animation
  }
}



// Initialize display on page load
updateCoinDisplay(0);



  // ------------------------------
  // MENU PANEL LOGIC
  // ------------------------------
  const menuPanel = document.getElementById('menuPanel');
  const openMenuBtn = document.getElementById('openMenuBtn');
  const closeMenuBtn = document.getElementById('closeMenuBtn');

  openMenuBtn.addEventListener('click', () => menuPanel.classList.remove('-translate-x-full'));
  closeMenuBtn.addEventListener('click', () => menuPanel.classList.add('-translate-x-full'));

  document.querySelectorAll('.year-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const nextList = btn.nextElementSibling;
      nextList.classList.toggle('hidden');
    });
  });
 
  

  // ------------------------------
  // Initialize AOS & Feather Icons
  // ------------------------------
  document.addEventListener('DOMContentLoaded', () => {
    AOS.init({ duration: 800, easing: 'ease-in-out', once: true });
    feather.replace();
    setupApp();  // Start main app logic
  });

  // ------------------------------
  // MAIN APP LOGIC
  // ------------------------------
  function setupApp() {
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const nextStep2 = document.getElementById('nextStep2');
    const nextStep3 = document.getElementById('nextStep3');
    const nextStep4 = document.getElementById('nextStep4');
    const submitQuiz = document.getElementById('submitQuiz');
    const restartQuiz = document.getElementById('restartQuiz');
    const newDocument = document.getElementById('newDocument');
    const quizOptions = document.querySelectorAll('.quiz-option');
    const closeQuiz = document.getElementById('closeQuiz');


    


    // Event listeners
    dropArea.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFileSelect);

    ['dragenter','dragover','dragleave','drop'].forEach(event => {
      dropArea.addEventListener(event, e => { e.preventDefault(); e.stopPropagation(); }, false);
    });

    ['dragenter','dragover'].forEach(event => dropArea.addEventListener(event, () => dropArea.classList.add('border-indigo-500','bg-indigo-50')));
    ['dragleave','drop'].forEach(event => dropArea.addEventListener(event, () => dropArea.classList.remove('border-indigo-500','bg-indigo-50')));
    dropArea.addEventListener('drop', handleDrop);

    nextStep2.addEventListener('click', () => showStep(3));
    nextStep3.addEventListener('click', () => showStep(4));
    nextStep4.addEventListener('click', () => generateQuiz());
    submitQuiz.addEventListener('click', calculateScore);
    restartQuiz.addEventListener('click', restartQuizFunc);
    newDocument.addEventListener('click', () => showStep(1));

    closeQuiz.addEventListener('click', () => {
    document.getElementById('app').classList.add('hidden');
    document.getElementById('publicFeed').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
});


    quizOptions.forEach(option => {
      option.addEventListener('click', function(){
        quizOptions.forEach(opt => opt.classList.remove('bg-indigo-200'));
        this.classList.add('bg-indigo-200');
        appState.quizQuestions = parseInt(this.dataset.questions);
      });
    });

    // ------------------------------
    // FILE PROCESSING
    // ------------------------------
    function preventDefaults(e){ e.preventDefault(); e.stopPropagation(); }
    function highlight(){ dropArea.classList.add('border-indigo-500','bg-indigo-50'); }
    function unhighlight(){ dropArea.classList.remove('border-indigo-500','bg-indigo-50'); }
    function handleDrop(e){
      const dt = e.dataTransfer;
      const files = dt.files;
      if(files.length){ fileInput.files = files; handleFileSelect({ target: fileInput }); }
    }

    async function handleFileSelect(event){
      const files = Array.from(event.target.files);
      if(!files.length) return;

      showLoading("Processing your document...");
      simulateProgress();

      try {
        let text = '';
        for(const file of files){
          const fileType = file.name.split('.').pop().toLowerCase();
          if(fileType === 'pdf'){ text += await extractTextFromPDF(file)+'\n\n'; }
          else if(fileType === 'doc' || fileType === 'docx'){ text += await extractTextFromWord(file)+'\n\n'; }
          else if(['jpg','jpeg','png'].includes(fileType)){ text += await extractTextFromImage(file)+'\n\n'; }
          else { throw new Error('Unsupported file type: ' + file.name); }
        }
        appState.extractedText = text;
        document.getElementById('extractedText').textContent = text;
        appState.simplifiedText = await simplifyText(text);
        document.getElementById('simplifiedText').textContent = appState.simplifiedText;

        hideLoading();
        showStep(2);
      } catch(err){ hideLoading(); alert('Error processing file: '+err.message); }
    }
}

    
    function extractTextFromPDF(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const typedArray = new Uint8Array(e.target.result);
                    pdfjsLib.getDocument(typedArray).promise.then(function(pdf) {
                        let text = '';
                        const numPages = pdf.numPages;
                        
                        const getPageText = async (pageNum) => {
                            const page = await pdf.getPage(pageNum);
                            const textContent = await page.getTextContent();
                            const strings = textContent.items.map(item => item.str);
                            text += strings.join(' ') + '\n\n';
                            
                            if (pageNum < numPages) {
                                await getPageText(pageNum + 1);
                            } else {
                                resolve(text);
                            }
                        };
                        
                        getPageText(1);
                    });
                } catch (err) {
                    reject(err);
                }
            };
            
            reader.onerror = reject;
            reader.readAsArrayBuffer(file);
        });
    }
    
    function extractTextFromWord(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                
                mammoth.extractRawText({ arrayBuffer: arrayBuffer })
                    .then(function(result) {
                        resolve(result.value);
                    })
                    .catch(function(error) {
                        reject(error);
                    });
            };
            
            reader.onerror = reject;
            reader.readAsArrayBuffer(file);
        });
    }
    
    // ‚úÖ Google Vision OCR (via backend)
async function extractTextFromImage(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = async function (e) {
            try {
                const base64Data = e.target.result.split(',')[1]; // strip "data:image/png;base64,"
                const res = await fetch("/api/ocr", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ images: [base64Data] }) // üëà wrap in array
                });
                const data = await res.json();
                if (res.ok && data.text) {
                    resolve(data.text);
                } else {
                    reject(new Error(data.error || "OCR failed"));
                }
            } catch (err) {
                reject(err);
            }
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}


    
    async function simplifyText(text) {
        try {
            const res = await fetch("/api/simplify", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text })
            });
            const data = await res.json();
            if (res.ok && data.simplified) {
                return data.simplified;
            } else {
                return `Here's a simple version:\n\n${text.slice(0, 500)}...`;
            }
        } catch (err) {
            console.error("Simplify failed:", err);
            return `Here's a simple version:\n\n${text.slice(0, 500)}...`;
        }
    }
    
    async function generateQuiz() {
        showLoading("Creating your quiz...");
        try {
            const res = await fetch("/api/quiz", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    text: appState.simplifiedText,
                    numQuestions: appState.quizQuestions
                })
            });
            const data = await res.json();
            if (!res.ok || !Array.isArray(data.quiz)) {
                throw new Error("Quiz API error");
            }
            appState.quizData = data.quiz.map(q => ({
                question: q.question || "Untitled question",
                options: Array.isArray(q.options) ? q.options.slice(0,4) : ["A","B","C","D"],
                correct: letterToIndex(q.correct ?? q.answer) >= 0 ? letterToIndex(q.correct ?? q.answer) : 0,

            }));
            displayQuiz();
            hideLoading();
            showStep(5);
        } catch (error) {
            hideLoading();
            console.error("Error generating quiz:", error);
            alert("Problem creating quiz. Check console.");
        }
    }

    // ‚úÖ Added missing displayQuiz function
    function displayQuiz() {
        const quizContainer = document.getElementById('quizContainer');
        quizContainer.innerHTML = '';
        appState.userAnswers = [];
        appState.quizData.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = "mb-6 p-4 bg-white shadow rounded-lg";
            const questionText = document.createElement('h4');
            questionText.className = "font-medium text-gray-800 mb-3";
            questionText.textContent = `Q${index + 1}: ${q.question}`;
            questionDiv.appendChild(questionText);
            const optionsDiv = document.createElement('div');
            optionsDiv.className = "grid grid-cols-1 gap-2";
            q.options.forEach((option, optIndex) => {
                const btn = document.createElement('button');
                btn.textContent = option;
                btn.className =
                    "w-full text-left px-4 py-2 rounded-lg border border-gray-300 hover:bg-indigo-50 transition";
                btn.addEventListener('click', () => {
                    appState.userAnswers[index] = optIndex;
                    Array.from(optionsDiv.children).forEach(child => {
                        child.classList.remove("bg-indigo-200");
                    });
                    btn.classList.add("bg-indigo-200");
                });
                optionsDiv.appendChild(btn);
            });
            questionDiv.appendChild(optionsDiv);
            quizContainer.appendChild(questionDiv);
        });
    }
    

    function calculateScore() {
        let correctCount = 0;
        appState.quizData.forEach((q, i) => {
            if (appState.userAnswers[i] === q.correct) correctCount++;
        });
        appState.score = Math.round((correctCount / appState.quizData.length) * 100);
        document.getElementById('score').textContent = appState.score;
        const resultMessage = document.getElementById('resultMessage');
        if (appState.score === 100) {
            resultMessage.textContent = "Perfect! You're a learning superstar!";
            updateCoinDisplay(10);
        } else if (appState.score >= 80) {
            resultMessage.textContent = "Great job! You know this well!";
            updateCoinDisplay(8);
        } else if (appState.score >= 60) {
            resultMessage.textContent = "Good effort! You're getting there!";
            updateCoinDisplay(3);
        } else if (appState.score >= 40) {
            resultMessage.textContent = "Keep practicing! You'll improve!";
            updateCoinDisplay(2);
        } else {
            resultMessage.textContent = "Nice try! Let's review and try again!";
        }
        const wrongAnswersContainer = document.getElementById('wrongAnswers');
        wrongAnswersContainer.innerHTML = '';
        let hasWrongAnswers = false;
        appState.quizData.forEach((q, i) => {
            if (appState.userAnswers[i] !== q.correct) {
                hasWrongAnswers = true;
                const wrongAnswerElement = document.createElement('div');
                wrongAnswerElement.className = 'mb-6 p-4 bg-gray-100 rounded-lg';
                wrongAnswerElement.innerHTML = `
                    <h4 class="font-medium text-gray-800 mb-2">Question: ${q.question}</h4>
                    <p class="text-red-600 mb-1">Your answer: ${q.options[appState.userAnswers[i]] || 'Not answered'}</p>
                    <p class="text-green-600">Correct answer: ${q.options[q.correct]}</p>
                `;
                wrongAnswersContainer.appendChild(wrongAnswerElement);
            }
        });
        if (!hasWrongAnswers) {
            wrongAnswersContainer.innerHTML = '<p class="text-center text-gray-600">You got all questions right! Amazing!</p>';
        }
        showStep(6);
    }
    
    function restartQuizFunc() {
        displayQuiz();
        showStep(5);
    }
    
    function showStep(stepNumber) {
        appState.currentStep = stepNumber;
        document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
        document.getElementById(`step${stepNumber}`).classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function showLoading(message) {
        document.getElementById('loadingMessage').textContent = message;
        document.getElementById('loading').classList.remove('hidden');
        document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
    }
    
    function hideLoading() {
        document.getElementById('loading').classList.add('hidden');
    }
    
    function simulateProgress() {
        let progress = 0;
        const progressFill = document.getElementById('progressFill');
        const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
            }
            progressFill.style.width = `${progress}%`;
        }, 300);
    }
// Convert letter "A"/"B"/"C"/"D" ‚Üí numeric index 0..3 (returns -1 if not found)
function letterToIndex(letter) {
  if (!letter || typeof letter !== 'string') return -1;
  return ['A','B','C','D'].indexOf(letter.toUpperCase());
}

// Convert numeric index 0..3 ‚Üí letter "A"/"B"/"C"/"D"
function indexToLetter(idx) {
  return ['A','B','C','D'][idx] || null;
}

// Load MTQ quiz from JSON
async function loadMTQQuestions(year, subject, category = 'ACCA') {
    const loader = document.getElementById('loading');
    if (loader) loader.style.display = 'block';

    try {
        console.log(`Loading ${category.toUpperCase()} ${subject.toUpperCase()} MTQs for ${year}...`);

        // Fetch the MTQ JSON
        const response = await fetch(`past_questions/${category}_${year}_${subject}.json`);
        if (!response.ok) throw new Error("Quiz not found");

        const data = await response.json();
        if (!Array.isArray(data.quiz)) throw new Error("Invalid quiz data");

        const quizData = data.quiz; // MTQ structure expected: tasks array per question

        // Get quiz container and reset
        const quizContainer = document.getElementById('quizContainer');
        if (!quizContainer) throw new Error("Missing #quizContainer element in DOM");
        quizContainer.innerHTML = '';

        // Initialize userAnswers as 2D array: question -> task
        appState.userAnswers = new Array(quizData.length).fill(null).map(() => []);

        // Render each MTQ question and its tasks
        quizData.forEach((q, qIndex) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = "mb-6 p-4 bg-white shadow rounded-lg";

            const questionText = document.createElement('h4');
            questionText.className = "font-medium text-gray-800 mb-3";
            questionText.textContent = `Q${qIndex + 1}: ${q.question || ''}`;
            questionDiv.appendChild(questionText);

            q.tasks.forEach((task, tIndex) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = "mb-3";

                const inputType = task.input_type === 'number' ? 'number' : 'text';
                const inputField = document.createElement('input');
                inputField.type = inputType;
                inputField.className = "w-full p-2 border rounded";
                inputField.placeholder = task.input_type === 'number' ? 'Enter number' : 'Enter text';

                // Store user input dynamically
                inputField.addEventListener('input', e => {
                    appState.userAnswers[qIndex][tIndex] = e.target.value.trim();
                });

                const label = document.createElement('label');
                label.textContent = task.task || '';
                taskDiv.appendChild(label);
                taskDiv.appendChild(inputField);
                questionDiv.appendChild(taskDiv);
            });

            quizContainer.appendChild(questionDiv);
        });

        // Show the MTQ step once (after rendering)
        showStep(5);
        document.getElementById('menuPanel')?.classList.add('-translate-x-full');

        // Wire the submit button to calculateMTQScore using addEventListener
        const scoreBtn = document.getElementById('submitQuiz');
        if (!scoreBtn) throw new Error("Missing #submitQuiz element in DOM");

        // Remove any prior MTQ listener to avoid duplicate calls
        scoreBtn.removeEventListener('click', scoreBtn._mtqHandler || (() => {}));

        // Create handler and store it for potential removal later
        const handler = () => calculateMTQScore(quizData);
        scoreBtn._mtqHandler = handler;
        scoreBtn.addEventListener('click', handler);

    } catch (error) {
        console.error("Error loading MTQ quiz:", error);
        alert("Problem loading MTQ quiz. Check console.");
    } finally {
        if (loader) loader.style.display = 'none';
    }
}

window.loadMTQQuestions = loadMTQQuestions;



  async function loadPastQuestions(year, subject, category = 'jamb') {
    const loader = document.getElementById('loading');
    if (loader) loader.style.display = 'block';

    try {
      console.log(`Loading ${category.toUpperCase()} ${subject.toUpperCase()} past questions for ${year}...`);

      const response = await fetch(`past_questions/${category}_${year}_${subject}.json`);
      if (!response.ok) throw new Error("Quiz not found");

      const data = await response.json();
      if (!Array.isArray(data.quiz)) throw new Error("Invalid quiz data");

      const pastQuizData = data.quiz.map((q) => {
        let optionsArr = Array.isArray(q.options) 
          ? q.options.slice(0,4)
          : ['A','B','C','D'].map(k => q.options?.[k]).filter(v => v !== undefined);

        let correctVal = q.correct ?? q.answer ?? q.correctIndex ?? null;
        let correctIndex = typeof correctVal === 'string' ? letterToIndex(correctVal) : correctVal ?? 0;

        return {
          question: q.question || "Untitled question",
          options: optionsArr,
          correct: correctIndex
        };
      });

    appState.quizData = pastQuizData;
    appState.userAnswers = [];
    displayQuiz();
    showStep(5);
    document.getElementById('menuPanel')?.classList.add('-translate-x-full');

  } catch (err) {
    console.error("Failed to load past questions:", err);
    alert("Could not load past questions. See console for details.");
  } finally {
    if (loader) loader.style.display = 'none';
  }
}

window.loadPastQuestions = loadPastQuestions;

function calculateMTQScore(quizData) {
    const results = [];
    let totalTasks = 0;
    let correctTasks = 0;

    quizData.forEach((q, qIndex) => {
        q.tasks.forEach((task, tIndex) => {
            totalTasks++;

            const userAnswer = appState.userAnswers[qIndex][tIndex] ?? "";
            const correctAnswer = task.correct;

            let isCorrect = false;

            if (task.input_type === "number") {
                isCorrect = Number(userAnswer) === Number(correctAnswer);
            } else if (task.expected_keywords) {
                const ans = String(userAnswer).trim().toLowerCase();
                isCorrect = task.expected_keywords.some(kw =>
                    ans.includes(kw.toLowerCase())
                );
            } else if (task.expected_keywords) {
                const ans = String(userAnswer).trim().toLowerCase();
                isCorrect = task.expected_keywords.some(kw =>
                    ans.includes(kw.toLowerCase())
                );
            } else {
                isCorrect =
                    String(userAnswer).trim().toLowerCase() ===
                    String(correctAnswer).trim().toLowerCase();
            }



            if (isCorrect) correctTasks++;

            results.push({
                questionNumber: qIndex + 1,
                taskLabel: task.task,
                userAnswer,
                correctAnswer,
                isCorrect
            });
        });
    });

    renderMTQResults(results, correctTasks, totalTasks);
    showStep(8);
}
window.calculateMTQScore = calculateMTQScore;



function renderMTQResults(results, correctTasks, totalTasks) {
    const container = document.getElementById('resultsContainer');
    container.innerHTML = '';

    const scoreDiv = document.createElement('div');
    scoreDiv.className = "p-4 mb-4 bg-blue-100 rounded shadow";
    scoreDiv.innerHTML = `
        <h3 class="text-xl font-semibold mb-2">MTQ Score</h3>
        <p><strong>${correctTasks}</strong> out of <strong>${totalTasks}</strong> tasks correct</p>
    `;
    container.appendChild(scoreDiv);

    results.forEach((r, idx) => {
        const div = document.createElement('div');
        div.className =
            'p-4 mb-3 rounded shadow ' +
            (r.isCorrect ? 'bg-green-100' : 'bg-red-100');

        div.innerHTML = `
            <h4 class="font-semibold">Q${r.questionNumber} ‚Äì ${r.taskLabel}</h4>
            <p><strong>Your Answer:</strong> ${r.userAnswer || "(blank)"}</p>
            <p><strong>Correct Answer:</strong> ${r.correctAnswer}</p>
            <p class="${r.isCorrect ? 'text-green-700' : 'text-red-700'} mt-1">
                ${r.isCorrect ? 'Correct ‚úî' : 'Wrong ‚úò'}
            </p>
        `;

        container.appendChild(div);
    });
}
window.renderMTQResults = renderMTQResults;






// Attach click handlers
document.querySelectorAll('.subject-btn').forEach(btn => {
  const yearBtn = btn.closest('li')?.querySelector('.year-btn');
  if (!yearBtn) return;

  const year = yearBtn.dataset.year;
  const subject = btn.textContent.trim().toLowerCase();

  btn.addEventListener('click', () => loadPastQuestions(year, subject));
});




const titleElement = document.getElementById("goquizTitle");

// Check localStorage on page load
const savedFirstName = localStorage.getItem("firstName");
if (savedFirstName) {
    titleElement.textContent = `GoQuiz ${savedFirstName}`;
   
}

function handleCredentialResponse(response) {
    if (!response.credential) return;

    const profile = jwt_decode(response.credential);
    const firstName = profile.given_name || (profile.name ? profile.name.split(" ")[0] : "User");

    // Update header
    titleElement.textContent = `GoQuiz ${firstName}`;

    // Save to localStorage
    localStorage.setItem("firstName", firstName);

   
}
// Menu toggling
document.getElementById('openMenuBtn').onclick = () => {
  document.getElementById('menuPanel').classList.remove('-translate-x-full');
};
  document.getElementById('closeMenuBtn').onclick = () => {
  document.getElementById('menuPanel').classList.add('-translate-x-full');
};










// === Load Public Quiz Feed from JAMB past questions ===
let allQuizzesGlobal = []; // store all quizzes globally

async function loadPublicFeed() {
    const feed = document.getElementById("publicFeed");
    feed.innerHTML = ""; // clear old feed
    allQuizzesGlobal = []; // reset global array

    const authors = ["Ada", "Urum", "Ibrahim", "Nwamaka", "Fatima", "Iroha", "Amiri"];
    const times = ["3h ago", "5h ago", "1 day ago", "2 days ago", "3 days ago"];

    try {
        const categories =['jamb', 'common entrance', 'acca']
        const years = [2020, 2021, 2022, 2023];
        const subjects = ["english","maths","physics","chemistry","biology","economics","literature",];
      
          for (const year of years) {
              for (const subject of subjects) {
                  try {
                      const res = await fetch(`past_questions/jamb_${year}_${subject}.json`);
                      if (!res.ok) continue;
                      const data = await res.json();
                      if (!data.quiz || !Array.isArray(data.quiz)) continue;

                      const normalized = data.quiz.map(q => {
                          let optionsArr = Array.isArray(q.options) ? q.options.slice(0,4) :
                                          q.options && typeof q.options === "object" ? ["A","B","C","D"].map(k => q.options[k]).filter(v => v) :
                                          ["A","B","C","D"];
                          let correctIndex = typeof q.correct === "string" ? letterToIndex(q.correct) :
                                            typeof q.answer === "string" ? letterToIndex(q.answer) :
                                            Number.isInteger(q.correct) ? q.correct :
                                            Number.isInteger(q.answer) ? q.answer : 0;

                          return {
                              title: `${subject.charAt(0).toUpperCase() + subject.slice(1)}: ${q.question?.slice(0,50) || "Untitled"}`,
                              author: authors[Math.floor(Math.random()*authors.length)],
                              question: q.question || "Untitled question",
                              options: optionsArr,
                              correct: correctIndex,
                              time: times[Math.floor(Math.random()*times.length)]
                          };
                      });

                      allQuizzesGlobal.push(...normalized);

                  } catch (err) {
                      console.warn(`Could not load ${year} ${subject}:`, err);
                  }
              }
          }

          renderFeedBatch(); // render first 10

      } catch (err) {
          console.error("Error loading public feed:", err);
          feed.innerHTML = `<p class="text-center text-gray-500">Failed to load feed.</p>`;
      }
    
    
  }

// Function to render 10 random quizzes from global array
function renderFeedBatch() {
    const feed = document.getElementById("publicFeed");
    feed.innerHTML = ""; // clear feed
    if (!allQuizzesGlobal.length) return;

    const feedQuizzes = allQuizzesGlobal.sort(() => 0.5 - Math.random()).slice(0,10);

    feedQuizzes.forEach(quiz => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-xl shadow p-5 hover:shadow-md transition border border-gray-100 mb-4";
        card.innerHTML = `
            <p class="text-lg font-semibold">${quiz.title}</p>
            <p class="text-gray-500 text-sm mb-3">Posted by ${quiz.author} | ${quiz.time}</p>
            <p class="text-gray-700 mb-4">${quiz.question}</p>
            <div class="options flex flex-col gap-2 mb-3"></div>
        `;

        const optionsDiv = card.querySelector(".options");
        quiz.options.forEach((opt, i) => {
            const btn = document.createElement("button");
            btn.className = "bg-indigo-600 text-white px-4 py-2 rounded-full text-sm hover:bg-indigo-700";
            btn.textContent = opt;
            btn.addEventListener("click", () => {
              if (i === quiz.correct) {
                btn.style.backgroundColor = "green";
                updateCoinDisplay(2); // gain 2 coins
              } else {
                btn.style.backgroundColor = "red";
                updateCoinDisplay(-1); // lose 1 coin
              }

              // disable all options
              Array.from(optionsDiv.children).forEach(b => b.disabled = true);
            });

            updateCoinDisplay();
            optionsDiv.appendChild(btn);
        });

        feed.appendChild(card);
    });

    // Add Load More button
    const loadMore = document.createElement("button");
    loadMore.textContent = "Load More";
    loadMore.className = "bg-gray-300 text-gray-800 px-6 py-2 rounded-full mt-4 hover:bg-gray-400";
    loadMore.addEventListener("click", renderFeedBatch);
    feed.appendChild(loadMore);
  // Show feed, hide quiz app
    document.getElementById('publicFeed').classList.remove('hidden');
    document.getElementById('app').classList.add('hidden');
    window.scroll({top:0, behavior:"smooth"});
   
 

}

window.addEventListener("DOMContentLoaded", loadPublicFeed);

// After 3.5s, hide splash and show main content
    setTimeout(() => {
      const splash = document.getElementById('splash');
      const main = document.getElementById('main-content');
      splash.style.display = 'none';
      main.style.display = 'block';
    }, 3500); // match animation timing


const steps = document.querySelectorAll('.step');
function showStep(n) {
  steps.forEach(s => s.classList.add('hidden'));
  document.getElementById('app').classList.remove('hidden');
  document.getElementById('publicFeed').classList.add('hidden'); // hide feed
  steps[n - 1].classList.remove('hidden');
   

  
};
// üé∂ Circular Music Menu Script
const menuToggle = document.getElementById("menu-toggle");
const circularMenu = document.getElementById("circular-menu");
const audioPlayer = document.getElementById("audio-player");

const playButton = document.getElementById("play-button");
const pauseButton = document.getElementById("pause-button");
const nextButton = document.getElementById("next-button");
const prevButton = document.getElementById("prev-button");

// Playlist
const tracks = [
  { name: "Relaxing Melody", src: "music/track1.mp3" },
  { name: "Focus Beat", src: "music/track2.mp3" },
  { name: "Chill Vibes", src: "music/track3.mp3" },
  { name: "Ambient Tune", src: "music/track4.mp3" },
   { name: "Relaxing Melody", src: "music/track5.mp3" },
  { name: "Focus Beat", src: "music/track6.mp3" },
  { name: "Chill Vibes", src: "music/track7.mp3" },
  { name: "Ambient Tune", src: "music/track8.mp3" },
   { name: "Relaxing Melody", src: "music/track9.mp3" },
  { name: "Focus Beat", src: "music/track10.mp3" },
  { name: "Chill Vibes", src: "music/track11.mp3" },
  { name: "Ambient Tune", src: "music/track12.mp3" },
  { name: "Chill Vibes", src: "music/track13.mp3" },
  { name: "Ambient Tune", src: "music/track14.mp3" },
];

let currentTrackIndex = Math.floor(Math.random() * tracks.length);

// Toggle open/close
menuToggle.addEventListener("click", () => {
  circularMenu.classList.toggle("open");
});

// Load and play a track
function loadTrack(index) {
  if (index < 0) index = tracks.length - 1;
  if (index >= tracks.length) index = 0;
  currentTrackIndex = index;

  const track = tracks[index];
  audioPlayer.src = track.src;
  audioPlayer.play().catch(err => console.log("‚ö†Ô∏è Autoplay blocked:", err));
}

// Controls
playButton.addEventListener("click", () => {
  if (!audioPlayer.src) loadTrack(currentTrackIndex);
  else audioPlayer.play();
});

pauseButton.addEventListener("click", () => audioPlayer.pause());

nextButton.addEventListener("click", () => {
  const nextIndex = Math.floor(Math.random() * tracks.length);
  loadTrack(nextIndex);
});

prevButton.addEventListener("click", () => {
  const prevIndex = Math.floor(Math.random() * tracks.length);
  loadTrack(prevIndex);
});

// Auto-next
audioPlayer.addEventListener("ended", () => {
  const nextIndex = Math.floor(Math.random() * tracks.length);
  loadTrack(nextIndex);
});

// Optional: Start a random track on load
window.addEventListener("DOMContentLoaded", () => {
  loadTrack(currentTrackIndex);
});



// ----------------------
// Teacher Form Overlay
// ----------------------
const openTeacherPost = document.getElementById("openTeacherPost");
const teacherFormOverlay = document.getElementById("teacherFormOverlay");
const closeTeacherPost = document.getElementById("closeTeacherPost");

openTeacherPost.onclick = () => teacherFormOverlay.classList.remove("hidden");
closeTeacherPost.onclick = () => teacherFormOverlay.classList.add("hidden");

// Store Teacher Posts Here
let teacherPosts = []; 
let teacherOverlayInterval = null;

document.getElementById("submitTeacherPost").onclick = async () => {
    const name = document.getElementById("teacherName").value.trim();
    const gender = document.getElementById("teacherGender").value;
    const subject = document.getElementById("teacherSubject").value.trim();
    const imageFile = document.getElementById("teacherImage").files[0];

    if (!name || !gender || !subject) {
        alert("Please fill all fields");
        return;
    }

    const formData = new FormData();
    formData.append("name", name);
    formData.append("gender", gender);
    formData.append("subject", subject);
    if (imageFile) formData.append("image", imageFile);

    try {
        const res = await fetch("/upload/teacher", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            alert("Teacher profile saved!");
            teacherFormOverlay.classList.add("hidden");

            teacherPosts.push({
                name,
                gender,
                subject,
                image: data.imageUrl || null
            });

        } else {
            alert("Failed to save");
        }
    } catch (err) {
        console.error(err);
        alert("Error submitting form.");
    }
};


// ----------------------
// Rotating Teacher Overlay (Top Bar)
// ----------------------
const teacherAdOverlay = document.getElementById("teacherAdOverlay");

// Ensure 'teacherAdOverlay' variable is defined globally or within scope
// e.g., const teacherAdOverlay = document.getElementById("teacherAdOverlay");

function showTeacherAdOverlay() {
    if (!teacherPosts.length) return;

    teacherAdOverlay.innerHTML = "";

    teacherPosts.forEach(post => {
        // ... (your existing card creation logic remains the same) ...
        const card = document.createElement("div");
        card.className = "flex bg-gray-100 rounded-lg p-2 items-center space-x-3 min-w-[200px] shadow";

        card.innerHTML = `
            <div>
              <img src="${post.image || post.imageUrl}" class="w-16 h-16 rounded-full object-cover" />

            </div>
            
            <div>
                <p class="font-bold">${post.name}</p>
                <p class="text-sm">${post.gender}</p> 
                <p class="font-bold">subject: ${post.subject}</p>
            </div>
        `;
        teacherAdOverlay.appendChild(card);
    });

    // --- ADDED TAILWIND CLASSES HERE ---
    // These classes make the overlay stick to the top-center of the screen
    teacherAdOverlay.classList.remove("hidden");
    teacherAdOverlay.classList.add(
        "fixed",           // Position it relative to the viewport
        "top-12",           // 1rem from the top
        "left-1/2",        // Start at the middle horizontal point
        "-translate-x-1/2",// Pull it back half its own width to center it perfectly
        "z-50",            // Ensure it appears on top of other content
        "flex",            // Use flexbox to line up the cards (assuming you want a row of ads)
        "space-x-4",       // Add spacing between the individual ad cards
        "p-4",             // Some padding around the entire overlay container
        "rounded-lg",      // Make the container itself look nice
        "bg-white",        // Give the container a background
        "shadow-2xl"       // Strong shadow for visibility
    );


    setTimeout(() => {
        // When hiding, ensure you remove the flex class if "hidden" relies on display: none
        teacherAdOverlay.classList.add("hidden");
        // Optional: Remove fixed classes if you plan to reuse the element for other purposes later
        // teacherAdOverlay.classList.remove("fixed", "top-4", "left-1/2", "-translate-x-1/2", "z-50", ...); 
    }, 30000);
}


function startTeacherOverlayCycle() {
    showTeacherAdOverlay();

    if (teacherOverlayInterval) clearInterval(teacherOverlayInterval);

    teacherOverlayInterval = setInterval(showTeacherAdOverlay, 5*60 * 1000);
}

// ‚ùå REMOVED AUTOMATIC START HERE
// startTeacherOverlayCycle();


// ----------------------
// Fetch teachers from backend (3 only)
// ----------------------
async function fetchRandomTeachers() {
    const res = await fetch("/upload/teachers/random");
    const data = await res.json();

    if (!data.success) return;

    // Always pick the first 3
    teacherPosts = data.teachers.slice(0, 3);
    
    startTeacherOverlayCycle();
}

fetchRandomTeachers();

// -------------------------------
// POINTS + GQ SYSTEM
// -------------------------------
let userPoints = parseInt(localStorage.getItem("userCoins")) || 0;
let userGQ = parseInt(localStorage.getItem("userGQ")) || 0;

// Update UI
function updateUI() {
    document.getElementById("coinNumber").textContent = userPoints;
    document.getElementById("GqCount").textContent = userGQ;

    // Save
    localStorage.setItem("userCoins", userPoints);
    localStorage.setItem("userGQ", userGQ);

    // Animation
    document.getElementById("GqCount").classList.add("scale-110");
    setTimeout(() => {
        document.getElementById("GqCount").classList.remove("scale-110");
    }, 200);
}

updateUI();

// -------------------------------
// OPEN / CLOSE MODAL
// -------------------------------
document.querySelector("#coinControls button").onclick = () => {
    document.getElementById("convertModal").style.display = "flex";
};

document.getElementById("closeConvertModal").onclick = () => {
    document.getElementById("convertModal").style.display = "none";
};

// -------------------------------
// CONVERSION LOGIC
// -------------------------------
document.getElementById("confirmConvert").onclick = () => {
    const from = document.getElementById("convertFrom").value;
    const to = document.getElementById("convertTo").value;
    const amount = parseInt(document.getElementById("convertAmount").value);

    if (!amount || amount <= 0) {
        alert("Enter a valid amount.");
        return;
    }

    // Prevent converting to same type
    if (from === to) {
        alert("Cannot convert to the same unit.");
        return;
    }

    // POINTS ‚Üí GQ
    if (from === "points" && to === "gq") {
        if (userPoints <= 0) {
            alert("You don't have enough points.");
            return;
        }

        let pointsToUse = Math.min(amount, userPoints);
        let gqEarned = Math.floor(pointsToUse / 100);
        let leftover = pointsToUse % 100;

        if (gqEarned === 0) {
            alert("Not enough points. You need 100pts = 1 GQ.");
            return;
        }

        userPoints -= pointsToUse;
        userPoints += leftover; // return leftover

        userGQ += gqEarned;
        alert(`Converted ${pointsToUse} points ‚Üí ${gqEarned} GQ`);

        updateUI();
    }

    // GQ ‚Üí POINTS
    if (from === "gq" && to === "points") {
        if (userGQ <= 0) {
            alert("You have no GQ to convert.");
            return;
        }

        let gqToUse = Math.min(amount, userGQ);
        let pointsGained = gqToUse * 100;

        userGQ -= gqToUse;
        userPoints += pointsGained;

        alert(`Converted ${gqToUse} GQ ‚Üí ${pointsGained} points`);
        updateUI();
    }

    // Close modal after conversion
    document.getElementById("convertModal").style.display = "none";
};





</script>
</body>
</html>